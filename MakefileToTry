# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: jrichard <marvin@42.fr>                    +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2016/11/14 16:32:32 by jrichard          #+#    #+#              #
#    Updated: 2017/02/27 11:45:55 by jrichard         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

NAME			= rtv1
LIBFT			= lib/libft/
LIBFTMATRIX		= lib/libft_matrix/
SDL				= lib/sdl/lib
SDL_PATH		= $(shell pwd)/lib/sdl

SRCDIR			= srcs/
INCDIR			= includes/
SDLINCDIR		= lib/sdl/include

SRC 			= camera.c cone.c cylinder.c light.c parser.c plane.c sphere.c \
				  events.c main.c parser_add_objs.c rt.c thpool.c utils.c
OBJ				= $(SRC:.c=.o)
CFLAGS			= -Wall -Wextra -Ofast -pthread

all: $(SDL) $(LIBFT) $(LIBFTMATRIX) $(NAME)

$(LIBFT):
	@$(MAKE) -C $@

$(LIBFTMATRIX):
	@$(MAKE) -C $@

$(NAME): $(OBJ)
	gcc -o $@ $^ -L$(LIBFT) -L$(LIBFTMATRIX) -L$(SDL) -lft -lft_matrix -lSDL2 -lm -lpthread -Wl,-rpath,$(SDL)

%.o: $(SRCDIR)%.c
	gcc -o $@ -c $< $(CFLAGS) -I$(INCDIR) -I$(LIBFT) -I$(LIBFTMATRIX) -I$(SDLINCDIR)

clean:
	rm -rf $(OBJ)
	@$(MAKE) clean -C $(LIBFT)
	@$(MAKE) clean -C $(LIBFTMATRIX)
	cd sdl/SDL2-2.0.5;make clean

fclean: clean 
	rm -f $(NAME)
	@$(MAKE) fclean -C $(LIBFT)
	@$(MAKE) fclean -C $(LIBFTMATRIX)
	cd sdl/SDL2-2.0.5;make uninstall
	rm -rf lib/sdl

re: fclean all

$(SDL):
	cd sdl/SDL2-2.0.5; \
		./configure --prefix=$(SDL_PATH) &&	make install

.PHONY: $(LIBFT)

.PHONY: $(LIBFTMATRIX)

.PHONY: sdl
